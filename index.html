<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>جدول الدوام الشهري</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --خفارة: #ffd8b1;
    --استراحة: #fff9c2;
    --صباحي: #c8e6c9;
    --مسائي: #bbdefb;
    --عطلة: #f8b6b6;
    --اجازة: #d1c4e9;
    --primary: #3498db;
    --dark: #2c3e50;
    --light: #ecf0f1;
    --success: #27ae60;
    --warning: #f39c12;
    --مباراة: #e1bee7;
}
* { box-sizing: border-box; font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { margin:0; padding:20px; background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); min-height:100vh; color:#333; }
.container { max-width:1200px; margin:20px auto; background:white; padding:25px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.15);}
.header { text-align:center; margin-bottom:20px; border-bottom:2px solid var(--light); padding-bottom:15px; }
h1 { margin-bottom:10px; font-size:2.2rem; color: var(--dark);}
.controls { display:flex; justify-content:center; align-items:center; margin-bottom:20px; gap:15px; flex-wrap:wrap; }
select, button { padding:10px 15px; border:2px solid #ddd; border-radius:8px; font-size:15px; transition: all 0.3s; }
select { min-width: 120px; }
button { background-color: var(--primary); color:white; display:flex; align-items:center; gap:6px; cursor:pointer; border: none; font-weight: 600; }
button:hover { background-color: #2980b9; transform: translateY(-2px); }
button.secondary { background-color: #7f8c8d; }
button.secondary:hover { background-color: #636e70; }
button.success { background-color: var(--success); }
button.success:hover { background-color: #219653; }
.legend { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin-bottom:25px; }
.legend-item { display:flex; align-items:center; gap:8px; padding:6px 12px; border-radius:6px; font-weight:500; background: #f8f9fa; border: 1px solid #eee; }
.legend-color { width:18px; height:18px; border-radius:4px; }
.calendar { display:grid; grid-template-columns: repeat(7,1fr); gap:10px; }
.day-cell { border:1px solid #ddd; border-radius:10px; padding:10px; min-height:140px; display:flex; flex-direction:column; justify-content:flex-start; position:relative; background:#fff; transition:all 0.3s; }
.day-cell.today { border:2px solid #e74c3c; box-shadow: 0 0 10px rgba(231, 76, 60, 0.3); }
.day-header { font-weight:bold; margin-bottom:8px; font-size: 0.9rem; display: flex; justify-content: space-between; }
.day-number { font-size: 1.2rem; font-weight: 700; }
.shift-select { margin-top:auto; padding:6px; border:1px solid #ccc; border-radius:6px; font-size:14px; background: white; }
.note { font-size:12px; color:#555; margin-top:6px; padding: 4px; background: #f9f9f9; border-radius: 4px; min-height: 32px; }
.btn-small { margin-top:5px; font-size:12px; padding:5px 8px; border-radius:5px; background:#95a5a6; color:white; cursor:pointer; border:none; }
.btn-small:hover { opacity: 0.9; }
.leave { background-color: var(--اجازة) !important; }
.status-bar { position: fixed; bottom: 20px; right: 20px; padding: 10px 15px; background: var(--success); color: white; border-radius: 5px; box-shadow: 0 3px 10px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s; }
.status-bar.show { opacity: 1; }
.actions { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
.cell-actions { display: flex; flex-direction: column; gap: 5px; margin-top: 8px; }
.match-note { color: #d32f2f; font-weight: bold; }

@media (max-width:1200px){ .calendar { grid-template-columns: repeat(4,1fr); } }
@media (max-width:768px){ 
    .calendar { grid-template-columns: repeat(2,1fr); } 
    .container { padding: 15px; }
    h1 { font-size: 1.8rem; }
}
@media (max-width:480px){ 
    .calendar { grid-template-columns: 1fr; } 
    .controls { flex-direction: column; }
    select, button { width: 100%; justify-content: center; }
}

/* --- تحسينات جدول الطباعة --- */
.print-container { display: none; }
.print-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; border: 1px solid #000; page-break-inside: avoid; }
.print-table th, .print-table td { border: 1px solid #000; padding: 8px; text-align: center; }
.print-table th { background: #eee; font-weight: 700; font-size: 16px; }
.print-header { text-align: center; margin-bottom: 15px; padding: 10px; }
.print-header h2 { margin: 0; font-size: 24px; color: #2c3e50; }
.print-header p { margin: 5px 0; font-size: 18px; }
.print-shift { font-weight: 600; padding: 4px 8px; border-radius: 4px; }

/* ألوان جدول الطباعة */
.print-morning { background-color: var(--صباحي); }
.print-evening { background-color: var(--مسائي); }
.print-guard { background-color: var(--خفارة); }
.print-rest { background-color: var(--استراحة); }
.print-leave { background-color: var(--اجازة); }

@media print {
    body, html { 
        background: #fff; 
        padding: 0; 
        margin: 0; 
        width: 210mm; /* عرض A4 */
        height: 297mm; /* ارتفاع A4 */
    }

    .container { 
        box-shadow: none; 
        padding: 5mm; 
        margin: 0; 
        width: 100%; 
        height: 100%;
        max-width: 100%;
    }

    .controls, .legend, .actions, #calendar, .header { 
        display: none; 
    }

    .print-container { 
        display: block; 
        width: 100%;
        height: 100%;
    }

    .print-table { 
        width: 100%;
        font-size: 12px;
    }

    .print-table th, .print-table td { 
        padding: 5px; 
        font-size: 12px;
    }

    .print-header h2 { 
        font-size: 20px; 
        margin-bottom: 5px;
    }

    .print-header p { 
        font-size: 16px; 
        margin: 2px 0;
    }

    /* منع تقسيم الجدول بين صفحات متعددة */
    .print-table { page-break-inside: avoid; }
    tr { page-break-inside: avoid; page-break-after: auto; }

    @page {
        size: A4;
        margin: 0;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>جدول الدوام الشهري</h1>
        <p>قم بإنشاء وإدارة جدول الدوام الشهري بسهولة</p>
    </div>

    <div class="controls">
        <select id="year-select"></select>
        <select id="month-select">
            <option value="0">يناير</option>
            <option value="1">فبراير</option>
            <option value="2">مارس</option>
            <option value="3">أبريل</option>
            <option value="4">مايو</option>
            <option value="5">يونيو</option>
            <option value="6">يوليو</option>
            <option value="7">أغسطس</option>
            <option value="8">سبتمبر</option>
            <option value="9">أكتوبر</option>
            <option value="10">نوفمبر</option>
            <option value="11">ديسمبر</option>
        </select>
        <button id="generate-btn"><i class="fas fa-sync-alt"></i> إنشاء الجدول</button>
    </div>

    <div class="actions">
        <button id="save-btn" class="success"><i class="fas fa-save"></i> حفظ الجدول</button>
        <button id="print-btn"><i class="fas fa-print"></i> طباعة الجدول</button>
        <button id="clear-btn" class="secondary"><i class="fas fa-trash-alt"></i> مسح الكل</button>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background:var(--خفارة)"></div> خفارة</div>
        <div class="legend-item"><div class="legend-color" style="background:var(--استراحة)"></div> استراحة</div>
        <div class="legend-item"><div class="legend-color" style="background:var(--صباحي)"></div> صباحي</div>
        <div class="legend-item"><div class="legend-color" style="background:var(--مسائي)"></div> مسائي</div>
        <div class="legend-item"><div class="legend-color" style="background:var(--اجازة)"></div> إجازة</div>
    </div>

    <div id="calendar" class="calendar"></div>

    <!-- طباعة الجدول -->
    <div class="print-container">
        <div class="print-header">
            <h2>جدول الدوام الشهري</h2>
            <p id="print-date-range"></p>
        </div>
        <table class="print-table">
            <thead>
                <tr>
                    <th>اليوم</th>
                    <th>التاريخ</th>
                    <th>نوع الدوام</th>
                    <th>ملاحظات</th>
                </tr>
            </thead>
            <tbody id="print-body"></tbody>
        </table>
    </div>
</div>

<div class="status-bar" id="status-bar">تم الحفظ بنجاح</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const yearSelect = document.getElementById('year-select');
    const monthSelect = document.getElementById('month-select');
    const generateBtn = document.getElementById('generate-btn');
    const saveBtn = document.getElementById('save-btn');
    const printBtn = document.getElementById('print-btn');
    const clearBtn = document.getElementById('clear-btn');
    const calendar = document.getElementById('calendar');
    const printBody = document.getElementById('print-body');
    const printDateRange = document.getElementById('print-date-range');
    const statusBar = document.getElementById('status-bar');

    // جدول المباريات الافتراضي (يتم إنشاؤه عشوائياً لكل شهر)
    const footballMatches = {
        // مانشستر يونايتد
        "MU": [
            { day: 5, opponent: "MC", home: true }, 
            { day: 12, opponent: "LIV", home: false },
            { day: 19, opponent: "ARS", home: true },
            { day: 26, opponent: "CHE", home: false }
        ],
        // مانشستر سيتي
        "MC": [
            { day: 5, opponent: "MU", home: false },
            { day: 13, opponent: "RM", home: true },
            { day: 20, opponent: "BAR", home: false },
            { day: 27, opponent: "LIV", home: true }
        ],
        // ليفربول
        "LIV": [
            { day: 6, opponent: "ARS", home: true },
            { day: 12, opponent: "MU", home: true },
            { day: 19, opponent: "CHE", home: false },
            { day: 27, opponent: "MC", home: false }
        ],
        // أرسنال
        "ARS": [
            { day: 6, opponent: "LIV", home: false },
            { day: 14, opponent: "BAR", home: true },
            { day: 19, opponent: "MU", home: false },
            { day: 28, opponent: "RM", home: true }
        ],
        // تشيلسي
        "CHE": [
            { day: 7, opponent: "RM", home: true },
            { day: 15, opponent: "BAR", home: false },
            { day: 19, opponent: "LIV", home: true },
            { day: 26, opponent: "MU", home: true }
        ],
        // برشلونة
        "BAR": [
            { day: 7, opponent: "CHE", home: false },
            { day: 14, opponent: "ARS", home: false },
            { day: 21, opponent: "RM", home: true },
            { day: 28, opponent: "MC", home: true }
        ],
        // ريال مدريد
        "RM": [
            { day: 7, opponent: "CHE", home: false },
            { day: 13, opponent: "MC", home: false },
            { day: 21, opponent: "BAR", home: false },
            { day: 28, opponent: "ARS", home: false }
        ]
    };

    // تهيئة السنوات في القائمة المنسدلة
    const currentYear = new Date().getFullYear();
    for(let y = currentYear - 1; y <= currentYear + 2; y++) {
        const opt = document.createElement('option');
        opt.value = y;
        opt.textContent = y;
        if(y === currentYear) opt.selected = true;
        yearSelect.appendChild(opt);
    }

    // تعيين الشهر الحالي كقيمة افتراضية
    monthSelect.value = new Date().getMonth();

    // إنشاء الجدول عند التحميل
    generateSchedule();

    // إضافة مستمعي الأحداث
    generateBtn.addEventListener('click', generateSchedule);
    saveBtn.addEventListener('click', saveSchedule);
    printBtn.addEventListener('click', preparePrint);
    clearBtn.addEventListener('click', clearSchedule);

    // دالة إنشاء الجدول
    function generateSchedule() {
        calendar.innerHTML = "";
        printBody.innerHTML = "";

        const year = parseInt(yearSelect.value);
        const month = parseInt(monthSelect.value);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysOfWeek = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
        const monthNames = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];

        // تحديث عنوان فترة الطباعة
        printDateRange.textContent = `لفترة: ${monthNames[month]} ${year}`;

        for(let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dayOfWeek = daysOfWeek[date.getDay()];
            const key = `${year}-${month + 1}-${day}`;

            // ----- الخلية في التقويم -----
            const cell = document.createElement('div');
            cell.className = "day-cell";

            // تمييز اليوم الحالي
            const today = new Date();
            if(day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                cell.classList.add("today");
            }

            // رأس الخلية (اليوم والتاريخ)
            const header = document.createElement('div');
            header.className = "day-header";
            header.innerHTML = `<span>${dayOfWeek}</span><span class="day-number">${day}</span>`;
            cell.appendChild(header);

            // قائمة اختيار نوع الدوام
            const select = document.createElement('select');
            select.className = "shift-select";
            const options = [
                {value: '', text: 'اختر الدوام'},
                {value: 'خفارة', text: 'خفارة'},
                {value: 'استراحة', text: 'استراحة'},
                {value: 'صباحي', text: 'صباحي'},
                {value: 'مسائي', text: 'مسائي'}
            ];

            options.forEach(opt => {
                const o = document.createElement('option');
                o.value = opt.value;
                o.textContent = opt.text;
                select.appendChild(o);
            });

            // استعادة القيم المحفوظة
            const saved = localStorage.getItem(key);
            if(saved) {
                select.value = saved;
                applyShift(cell, saved);
            }

            select.addEventListener('change', function() {
                localStorage.setItem(key, this.value);
                applyShift(cell, this.value);
                showStatus("تم تحديث نوع الدوام");
            });

            cell.appendChild(select);

            // منطقة الملاحظات
            const note = document.createElement('div');
            note.className = "note";
            const savedNote = localStorage.getItem(key + "-note") || "";
            
            // التحقق من وجود مباراة في هذا اليوم
            let matchText = "";
            for (const team in footballMatches) {
                const matches = footballMatches[team];
                const match = matches.find(m => m.day === day);
                if (match) {
                    if (matchText) matchText += " | ";
                    matchText += match.home ? 
                        `${team} vs ${match.opponent} (د)` : 
                        `${match.opponent} vs ${team} (خ)`;
                }
            }
            
            // دمج الملاحظات المحفوظة مع المباريات
            if (matchText) {
                note.innerHTML = `<div class="match-note">${matchText}</div>${savedNote}`;
            } else {
                note.textContent = savedNote;
            }
            
            cell.appendChild(note);

            // أزرار الإجراءات
            const actions = document.createElement('div');
            actions.className = "cell-actions";

            // زر الإجازة
            const leaveBtn = document.createElement('button');
            leaveBtn.className = "btn-small";
            leaveBtn.innerHTML = '<i class="fas fa-umbrella-beach"></i> إجازة';
            leaveBtn.addEventListener('click', function() {
                cell.classList.toggle("leave");
                if(cell.classList.contains("leave")) {
                    localStorage.setItem(key + "-leave", "1");
                    showStatus("تم تعيين اليوم كإجازة");
                } else {
                    localStorage.removeItem(key + "-leave");
                    showStatus("تم إلغاء الإجازة");
                }
            });
            actions.appendChild(leaveBtn);

            // زر الملاحظة
            const noteBtn = document.createElement('button');
            noteBtn.className = "btn-small";
            noteBtn.innerHTML = '<i class="fas fa-edit"></i> ملاحظة';
            noteBtn.addEventListener('click', function() {
                const newNote = prompt("اكتب الملاحظة:", savedNote);
                if(newNote !== null) {
                    // الحفاظ على نص المباراة عند تعديل الملاحظة
                    let finalNote = newNote;
                    if (matchText) {
                        note.innerHTML = `<div class="match-note">${matchText}</div>${finalNote}`;
                    } else {
                        note.textContent = finalNote;
                    }
                    localStorage.setItem(key + "-note", newNote);
                    showStatus("تم حفظ الملاحظة");
                }
            });
            actions.appendChild(noteBtn);

            cell.appendChild(actions);

            // تطبيق الإجازة إذا كانت محفوظة
            if(localStorage.getItem(key + "-leave")) {
                cell.classList.add("leave");
            }

            calendar.appendChild(cell);
        }

        // إنشاء جدول الطباعة
        updatePrintTable();
    }

    // تطبيق لون نوع الدوام على الخلية
    function applyShift(cell, value) {
        cell.style.backgroundColor = "";
        if(value) {
            const color = getComputedStyle(document.documentElement).getPropertyValue(`--${value}`);
            cell.style.backgroundColor = color;
        }
    }

    // عرض رسالة حالة
    function showStatus(message) {
        statusBar.textContent = message;
        statusBar.classList.add("show");

        setTimeout(() => {
            statusBar.classList.remove("show");
        }, 2000);
    }

    // حفظ الجدول
    function saveSchedule() {
        showStatus("تم حفظ الجدول بنجاح");
    }

    // مسح الجدول
    function clearSchedule() {
        if(confirm("هل أنت متأكد من أنك تريد مسح كل البيانات؟ لا يمكن التراجع عن هذا الإجراء.")) {
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for(let day = 1; day <= daysInMonth; day++) {
                const key = `${year}-${month + 1}-${day}`;
                localStorage.removeItem(key);
                localStorage.removeItem(key + "-note");
                localStorage.removeItem(key + "-leave");
            }

            generateSchedule();
            showStatus("تم مسح جميع البيانات");
        }
    }

    // تحديث جدول الطباعة
    function updatePrintTable() {
        printBody.innerHTML = "";
        const year = parseInt(yearSelect.value);
        const month = parseInt(monthSelect.value);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysOfWeek = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
        const monthNames = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];

        for(let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dayOfWeek = daysOfWeek[date.getDay()];
            const key = `${year}-${month + 1}-${day}`;

            const tr = document.createElement('tr');

            // عمود اليوم
            const tdDay = document.createElement('td');
            tdDay.textContent = dayOfWeek;
            tr.appendChild(tdDay);

            // عمود التاريخ
            const tdDate = document.createElement('td');
            tdDate.textContent = `${day}/${month + 1}/${year}`;
            tr.appendChild(tdDate);

            // عمود الدوام
            const tdShift = document.createElement('td');
            const shiftValue = localStorage.getItem(key) || "";

            // إضافة لون لنوع الدوام
            if (shiftValue === "صباحي") {
                tdShift.classList.add("print-morning");
            } else if (shiftValue === "مسائي") {
                tdShift.classList.add("print-evening");
            } else if (shiftValue === "خفارة") {
                tdShift.classList.add("print-guard");
            } else if (shiftValue === "استراحة") {
                tdShift.classList.add("print-rest");
            }

            // التحقق من الإجازة
            if(localStorage.getItem(key + "-leave")) {
                tdShift.classList.add("print-leave");
                tdShift.textContent = shiftValue ? `${shiftValue} (إجازة)` : "إجازة";
            } else {
                tdShift.textContent = shiftValue;
            }

            tr.appendChild(tdShift);

            // عمود الملاحظات
            const tdNote = document.createElement('td');
            const noteValue = localStorage.getItem(key + "-note") || "";
            
            // التحقق من وجود مباراة في هذا اليوم
            let matchText = "";
            for (const team in footballMatches) {
                const matches = footballMatches[team];
                const match = matches.find(m => m.day === day);
                if (match) {
                    if (matchText) matchText += " | ";
                    matchText += match.home ? 
                        `${team} vs ${match.opponent} (د)` : 
                        `${match.opponent} vs ${team} (خ)`;
                }
            }
            
            // دمج الملاحظات المحفوظة مع المباريات
            if (matchText) {
                tdNote.innerHTML = `<strong>${matchText}</strong><br>${noteValue}`;
            } else {
                tdNote.textContent = noteValue;
            }
            
            tr.appendChild(tdNote);

            printBody.appendChild(tr);
        }
    }

    // تحضير الطباعة
    function preparePrint() {
        updatePrintTable();
        setTimeout(() => {
            window.print();
        }, 100);
    }
});
</script>
</body>
</html>